<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>注文书管理</title>
  <style>
    :root{
      --bg:#f3f5fb;
      --card:#ffffff;
      --text:#1f2a3d;
      --muted:#8891a7;
      --border:#e5e9f2;
      --primary:#246bfd;
      --shadow: 0 12px 28px rgba(31, 53, 90, .08);
      --radius: 16px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: "PingFang SC", -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: var(--bg);
      color:var(--text);
    }

    .container{
      padding:24px;
      width:100%;
      margin:0;
    }
    .page-head{
      display:grid;
      grid-template-columns: 1fr auto 1fr;
      align-items:center;
      gap:16px;
      margin-bottom:16px;
    }
    .title{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:20px;
      font-weight:800;
      margin:0;
    }
    .title::before{
      content:"";
      width:4px;
      height:20px;
      border-radius:12px;
      background: var(--primary);
      box-shadow: 0 0 0 6px rgba(36, 107, 253, 0.15);
    }
    .title h1{
      margin:0;
      font-size:inherit;
      font-weight:inherit;
    }
    .btn{
      padding:10px 16px;
      border-radius:8px;
      border:1px solid var(--primary);
      background: var(--primary);
      font-weight:700;
      font-size:13px;
      cursor:pointer;
      color:#fff;
    }
    .action-btn{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:10px 18px;
      border-radius:10px;
      font-weight:600;
      color:#fff;
      border:none;
      cursor:pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      box-shadow: 0 8px 16px rgba(15, 23, 42, 0.12);
    }
    .action-btn:active{ transform: scale(0.97); }
    .btn-blue{ background:#1c7bff; }
    .btn-search{
      background:#10b981;
      color:#fff;
      box-shadow: 0 10px 18px rgba(16, 185, 129, 0.3);
      border:none;
      border-radius:12px;
      padding:10px 16px;
      cursor:pointer;
      font-weight:600;
    }
    .btn-reset{
      background:#f59e0b;
      color:#fff;
      box-shadow: 0 10px 18px rgba(245, 158, 11, 0.35);
      border:none;
      border-radius:12px;
      padding:10px 16px;
      cursor:pointer;
      font-weight:600;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      padding:22px 26px 10px;
    }

    .switch-wrap{
      justify-self:center;
      display:flex;
      align-items:center;
    }
    .switcher{
      display:inline-flex;
      gap:6px;
      padding:6px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.5);
      background: rgba(248,250,252,.95);
      box-shadow: 0 10px 20px rgba(30,41,59,.08);
    }
    .switch-btn{
      border:0;
      background:transparent;
      padding:8px 20px;
      border-radius:999px;
      font-size:14px;
      font-weight:900;
      cursor:pointer;
      color:#334155;
    }
    .switch-btn.active{
      background: rgba(30,64,175,.16);
      color:#1d4ed8;
      box-shadow: 0 6px 14px rgba(29,78,216,.12);
    }

    .filters{
      padding:0;
      border-bottom:0;
      background: transparent;
      display:grid;
      gap:14px;
      margin-bottom:18px;
    }
    .filters-grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:14px;
    }
    .filters-actions{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:12px;
    }
    .filters-actions-left,
    .filters-actions-right{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
    }
    .field{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid var(--border);
      background:#fff;
      font-size:13px;
      font-weight:700;
      color:#2c3d55;
      min-height:44px;
    }
    .field input, .field select{
      border:0;
      outline:none;
      font-size:14px;
      font-weight:600;
      color:#1f2937;
      background:transparent;
      min-width:120px;
      flex:1 1 auto;
    }
    .field > span{
      white-space:nowrap;
      flex:0 0 auto;
    }
    .field.wide{ grid-column: span 1; }
    .field.narrow{ grid-column: span 1; }
    .field .range{
      display:flex;
      align-items:center;
      gap:6px;
    }

    table{ width:100%; border-collapse:collapse; font-size:13px; }
    thead th{
      text-align:center;
      padding:12px 8px;
      color:var(--muted);
      font-weight:600;
      border-bottom:1px solid var(--border);
      background: transparent;
    }
    tbody td{
      text-align:center;
      padding:14px 8px;
      border-bottom:1px solid var(--border);
      font-weight:600;
      color:#2c3d55;
    }
    .cell-ellipsis{
      max-width:220px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin:0 auto;
    }
    tbody tr:hover{ background: rgba(36, 107, 253, 0.08); }

    .tag{
      display:inline-flex;
      align-items:center;
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:800;
      border:1px solid transparent;
    }
    .tag.success{ color:#0f7a3a; background: rgba(22,163,74,.12); border-color: rgba(22,163,74,.22); }
    .tag.warn{ color:#a16207; background: rgba(245,158,11,.16); border-color: rgba(245,158,11,.25); }
    .tag.danger{ color:#b91c1c; background: rgba(239,68,68,.14); border-color: rgba(239,68,68,.25); }
    .tag.info{ color:#1d4ed8; background: rgba(28,123,255,.12); border-color: rgba(28,123,255,.22); }
    .tag.neutral{ color:#4b5563; background: rgba(148,163,184,.16); border-color: rgba(148,163,184,.3); }

    .btn-lite{
      padding:6px 10px;
      border-radius:8px;
      border:1px solid var(--primary);
      background: var(--primary);
      color:#fff;
      font-weight:600;
      cursor:pointer;
    }
    .btn-ghost{
      padding:6px 10px;
      border-radius:8px;
      border:1px solid var(--primary);
      background: var(--primary);
      color:#fff;
      font-weight:600;
      cursor:pointer;
    }
    .row-actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .modal{
      border:0;
      border-radius:16px;
      padding:20px;
      width:min(420px, 92vw);
      box-shadow: 0 24px 60px rgba(31, 53, 90, 0.25);
      font-family: inherit;
    }
    .modal-form{
      display:grid;
      gap:12px;
      margin-bottom:16px;
    }
    .modal-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:12px;
    }
    .modal .field{
      padding:10px 12px;
      min-height:unset;
    }
    .modal .field input,
    .modal .field select{
      min-width:0;
    }
    .modal input[readonly],
    .modal input:disabled,
    .modal select:disabled{
      background:#f1f5f9;
      color:#64748b;
      cursor:not-allowed;
    }
    .modal .field.full{
      grid-column:1 / -1;
    }
    .modal::backdrop{
      background: rgba(15, 23, 42, 0.4);
    }
    .modal h3{
      margin:0 0 8px;
      font-size:18px;
      font-weight:800;
      color:var(--text);
    }
    .modal p{
      margin:0 0 16px;
      color:var(--muted);
      font-size:14px;
    }
    .modal-actions{
      display:flex;
      justify-content:flex-end;
      gap:8px;
    }
    @media (max-width: 900px){
      .page-head{
        grid-template-columns: 1fr;
        align-items:stretch;
      }
      .switch-wrap{ justify-self:flex-start; }
      .filters-grid{ grid-template-columns: 1fr; }
      .field{ min-height:44px; }
      .modal-grid{ grid-template-columns: 1fr; }
      table{ display:block; overflow:auto; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="page-head">
      <div class="title">
        <h1>注文书管理</h1>
      </div>
      <div class="switch-wrap">
        <div class="switcher" role="tablist" aria-label="视角切换">
          <button class="switch-btn active" type="button" data-view="issue" role="tab" aria-selected="true">发注</button>
          <button class="switch-btn" type="button" data-view="accept" role="tab" aria-selected="false">受注</button>
        </div>
      </div>
    </div>

    <section class="card">
      <div class="filters">
        <div class="filters-grid">
          <div class="field wide">
            <span>注文书号</span>
            <input type="text" placeholder="PO-XXXX" />
          </div>
          <div class="field wide">
            <span>案件名</span>
            <input type="text" placeholder="SES 案件名" />
          </div>
          <div class="field wide">
            <span data-issue="取引先（下请公司）" data-accept="取引先（客户公司）">取引先（下请公司）</span>
            <input type="text" placeholder="下请公司" data-issue-placeholder="下请公司" data-accept-placeholder="客户公司" />
          </div>
          <div class="field wide">
            <span>技术者</span>
            <input type="text" placeholder="姓名" />
          </div>
          <div class="field narrow">
            <span>状态</span>
            <select id="statusFilter"
                    data-issue-options="承认中,已受注,拒绝,已取消"
                    data-accept-options="已受注,拒绝,已取消"
                    data-default-option="全部">
              <option>全部</option>
            </select>
          </div>
          <div class="field wide">
            <span>创建期间</span>
            <div class="range">
              <input type="date" />
              <span>~</span>
              <input type="date" />
            </div>
          </div>
        </div>
        <div class="filters-actions">
          <div class="filters-actions-left">
            <button class="action-btn btn-blue" id="createBtn" type="button" data-issue="新建注文书" data-accept="新建受注">＋ 新建注文书</button>
          </div>
          <div class="filters-actions-right">
            <button class="btn-search" type="button">搜索</button>
            <button class="btn-reset" type="button">重置</button>
          </div>
        </div>
      </div>

      <table>
        <thead>
          <tr data-order-no="PO-2024-019"
              data-project="数据平台升级"
              data-client-issue="富士商事"
              data-client-accept="富士商事"
              data-engineer="田中"
              data-price="¥ 480,000"
              data-hours="160h"
              data-start="2024-06-01"
              data-end="2024-12-31"
              data-created-at="2024-05-18"
              data-creator="王敏"
              data-owner="高桥"
              data-updated-at="2024-06-05"
              data-updater="刘洋">
            <th>注文No</th>
            <th data-issue="案件名 / 取引先（下请）" data-accept="案件名 / 取引先（客户）">案件名 / 取引先（下请）</th>
            <th>技术者</th>
            <th>契约单价</th>
            <th>契约工时</th>
            <th>契约期间</th>
            <th>创建时间</th>
            <th>创建人</th>
            <th>负责人</th>
            <th>修改时间</th>
            <th>修改人</th>
            <th>状态</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          <tr data-order-no="PO-2024-031"
              data-project="移动端改版"
              data-client-issue="星河科技"
              data-client-accept="星河科技"
              data-engineer="李娜"
              data-price="¥ 220,000"
              data-hours="180h"
              data-start="2024-07-01"
              data-end="2025-01-31"
              data-created-at="2024-06-02"
              data-creator="陈洁"
              data-owner="铃木"
              data-updated-at="2024-06-20"
              data-updater="张昊">
            <td>PO-2024-019</td>
            <td>
              <div class="cell-ellipsis" title="数据平台升级">数据平台升级</div>
              <div class="cell-ellipsis" title="富士商事">富士商事</div>
            </td>
            <td>田中</td>
            <td>¥ 480,000</td>
            <td>160h</td>
            <td>
              <div>2024-06</div>
              <div>2024-12</div>
            </td>
            <td>2024-05-18</td>
            <td>王敏</td>
            <td>高桥</td>
            <td>2024-06-05</td>
            <td>刘洋</td>
            <td><span class="tag" data-status-badge data-issue-status="承认中" data-accept-status="已受注">承认中</span></td>
            <td><div class="row-actions" data-row-actions></div></td>
          </tr>
          <tr data-order-no="PO-2024-038"
              data-project="接口整合"
              data-client-issue="日科解决方案"
              data-client-accept="日科解决方案"
              data-engineer="佐藤"
              data-price="¥ 95,000"
              data-hours="160h"
              data-start="2024-05-01"
              data-end="2024-10-31"
              data-created-at="2024-04-21"
              data-creator="赵磊"
              data-owner="山本"
              data-updated-at="2024-05-02"
              data-updater="吴敏">
            <td>PO-2024-031</td>
            <td>
              <div class="cell-ellipsis" title="移动端改版">移动端改版</div>
              <div class="cell-ellipsis" title="星河科技">星河科技</div>
            </td>
            <td>李娜</td>
            <td>¥ 220,000</td>
            <td>180h</td>
            <td>
              <div>2024-07</div>
              <div>2025-01</div>
            </td>
            <td>2024-06-02</td>
            <td>陈洁</td>
            <td>铃木</td>
            <td>2024-06-20</td>
            <td>张昊</td>
            <td><span class="tag" data-status-badge data-issue-status="已受注" data-accept-status="拒绝">已受注</span></td>
            <td><div class="row-actions" data-row-actions></div></td>
          </tr>
          <tr>
            <td>PO-2024-038</td>
            <td>
              <div class="cell-ellipsis" title="接口整合">接口整合</div>
              <div class="cell-ellipsis" title="日科解决方案">日科解决方案</div>
            </td>
            <td>佐藤</td>
            <td>¥ 95,000</td>
            <td>160h</td>
            <td>
              <div>2024-05</div>
              <div>2024-10</div>
            </td>
            <td>2024-04-21</td>
            <td>赵磊</td>
            <td>山本</td>
            <td>2024-05-02</td>
            <td>吴敏</td>
            <td><span class="tag" data-status-badge data-issue-status="已取消" data-accept-status="已取消">已取消</span></td>
            <td><div class="row-actions" data-row-actions></div></td>
          </tr>
        </tbody>
      </table>
    </section>
  </div>

  <dialog class="modal" id="createDialogIssue" aria-labelledby="createTitleIssue">
    <h3 id="createTitleIssue">新建注文书</h3>
    <p>请根据注文书字段填写基础信息。</p>
    <div class="modal-form">
      <div class="modal-grid">
        <label class="field">
          <span>注文No</span>
          <input type="text" placeholder="PO-2024-XXX" />
        </label>
        <label class="field">
          <span>案件名</span>
          <input type="text" placeholder="案件名称" />
        </label>
        <label class="field full">
          <span>取引先（下请公司）</span>
          <input type="text" placeholder="下请公司" />
        </label>
        <label class="field">
          <span>SES 工程师</span>
          <input type="text" placeholder="姓名" />
        </label>
        <label class="field">
          <span>状态</span>
          <select>
            <option>请选择状态</option>
            <option>承认中</option>
            <option>已受注</option>
            <option>拒绝</option>
            <option>已取消</option>
          </select>
        </label>
        <label class="field">
          <span>契约单价</span>
          <input type="text" placeholder="¥ 0" />
        </label>
        <label class="field">
          <span>契约工时</span>
          <input type="text" placeholder="160h" />
        </label>
        <label class="field full">
          <span>契约期间</span>
          <div class="range">
            <input type="date" />
            <span>~</span>
            <input type="date" />
          </div>
        </label>
        <label class="field">
          <span>创建时间</span>
          <input type="date" />
        </label>
        <label class="field">
          <span>创建人</span>
          <input type="text" placeholder="姓名" />
        </label>
        <label class="field">
          <span>负责人</span>
          <input type="text" placeholder="姓名" />
        </label>
        <label class="field">
          <span>修改时间</span>
          <input type="date" />
        </label>
        <label class="field">
          <span>修改人</span>
          <input type="text" placeholder="姓名" />
        </label>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn" type="button" data-dialog-close>取消</button>
      <button class="btn" type="button" data-dialog-close>开始创建</button>
    </div>
  </dialog>

  <dialog class="modal" id="createDialogAccept" aria-labelledby="createTitleAccept">
    <h3 id="createTitleAccept">新建受注</h3>
    <p>请根据受注字段填写基础信息。</p>
    <div class="modal-form">
      <div class="modal-grid">
        <label class="field">
          <span>注文No</span>
          <input type="text" placeholder="PO-2024-XXX" />
        </label>
        <label class="field">
          <span>案件名</span>
          <input type="text" placeholder="案件名称" />
        </label>
        <label class="field full">
          <span>取引先（客户公司）</span>
          <input type="text" placeholder="客户公司" />
        </label>
        <label class="field">
          <span>SES 工程师</span>
          <input type="text" placeholder="姓名" />
        </label>
        <label class="field">
          <span>状态</span>
          <select>
            <option>请选择状态</option>
            <option>已受注</option>
            <option>拒绝</option>
            <option>已取消</option>
          </select>
        </label>
        <label class="field">
          <span>契约单价</span>
          <input type="text" placeholder="¥ 0" />
        </label>
        <label class="field">
          <span>契约工时</span>
          <input type="text" placeholder="160h" />
        </label>
        <label class="field full">
          <span>契约期间</span>
          <div class="range">
            <input type="date" />
            <span>~</span>
            <input type="date" />
          </div>
        </label>
        <label class="field">
          <span>创建时间</span>
          <input type="date" />
        </label>
        <label class="field">
          <span>创建人</span>
          <input type="text" placeholder="姓名" />
        </label>
        <label class="field">
          <span>负责人</span>
          <input type="text" placeholder="姓名" />
        </label>
        <label class="field">
          <span>修改时间</span>
          <input type="date" />
        </label>
        <label class="field">
          <span>修改人</span>
          <input type="text" placeholder="姓名" />
        </label>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn" type="button" data-dialog-close>取消</button>
      <button class="btn" type="button" data-dialog-close>开始创建</button>
    </div>
  </dialog>

  <dialog class="modal" id="detailDialog" aria-labelledby="detailTitle">
    <h3 id="detailTitle">查看注文书</h3>
    <p id="detailSubtitle">查看订单详情</p>
    <div class="modal-form">
      <div class="modal-grid">
        <label class="field">
          <span>注文No</span>
          <input type="text" data-field="orderNo" />
        </label>
        <label class="field">
          <span>案件名</span>
          <input type="text" data-field="project" />
        </label>
        <label class="field full">
          <span data-issue="取引先（下请公司）" data-accept="取引先（客户公司）">取引先（下请公司）</span>
          <input type="text" data-field="client" />
        </label>
        <label class="field">
          <span>技术者</span>
          <input type="text" data-field="engineer" />
        </label>
        <label class="field">
          <span>状态</span>
          <select data-field="status"
                  data-issue-options="承认中,已受注,拒绝,已取消"
                  data-accept-options="已受注,拒绝,已取消"
                  data-default-option="请选择状态">
          </select>
        </label>
        <label class="field">
          <span>契约单价</span>
          <input type="text" data-field="price" />
        </label>
        <label class="field">
          <span>契约工时</span>
          <input type="text" data-field="hours" />
        </label>
        <label class="field full">
          <span>契约期间</span>
          <div class="range">
            <input type="date" data-field="start" />
            <span>~</span>
            <input type="date" data-field="end" />
          </div>
        </label>
        <label class="field">
          <span>创建时间</span>
          <input type="date" data-field="createdAt" />
        </label>
        <label class="field">
          <span>创建人</span>
          <input type="text" data-field="creator" />
        </label>
        <label class="field">
          <span>负责人</span>
          <input type="text" data-field="owner" />
        </label>
        <label class="field">
          <span>修改时间</span>
          <input type="date" data-field="updatedAt" />
        </label>
        <label class="field">
          <span>修改人</span>
          <input type="text" data-field="updater" />
        </label>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn" type="button" data-dialog-close>关闭</button>
      <button class="btn" type="button" data-dialog-close id="detailSave">保存</button>
    </div>
  </dialog>
  <script>
    (function () {
      const switches = Array.from(document.querySelectorAll(".switch-btn"));
      const swapNodes = Array.from(document.querySelectorAll("[data-issue][data-accept]"));
      const swapPlaceholders = Array.from(document.querySelectorAll("[data-issue-placeholder][data-accept-placeholder]"));
      const rows = Array.from(document.querySelectorAll("tbody tr"));
      const statusFilter = document.getElementById("statusFilter");
      const createBtn = document.getElementById("createBtn");
      const createDialogIssue = document.getElementById("createDialogIssue");
      const createDialogAccept = document.getElementById("createDialogAccept");
      const detailDialog = document.getElementById("detailDialog");
      const detailTitle = document.getElementById("detailTitle");
      const detailSubtitle = document.getElementById("detailSubtitle");
      const detailSave = document.getElementById("detailSave");
      const detailFields = {
        orderNo: document.querySelector('[data-field="orderNo"]'),
        project: document.querySelector('[data-field="project"]'),
        client: document.querySelector('[data-field="client"]'),
        engineer: document.querySelector('[data-field="engineer"]'),
        status: document.querySelector('[data-field="status"]'),
        price: document.querySelector('[data-field="price"]'),
        hours: document.querySelector('[data-field="hours"]'),
        start: document.querySelector('[data-field="start"]'),
        end: document.querySelector('[data-field="end"]'),
        createdAt: document.querySelector('[data-field="createdAt"]'),
        creator: document.querySelector('[data-field="creator"]'),
        owner: document.querySelector('[data-field="owner"]'),
        updatedAt: document.querySelector('[data-field="updatedAt"]'),
        updater: document.querySelector('[data-field="updater"]')
      };
      const dialogCloseButtons = Array.from(document.querySelectorAll("[data-dialog-close]"));

      const statusClass = {
        "草稿": "neutral",
        "承认中": "warn",
        "已送付": "info",
        "已受注": "success",
        "已取消": "danger",
        "拒绝": "danger"
      };

      const actionsByView = {
        issue: {
          "草稿": ["编辑", "查看"],
          "承认中": ["编辑", "查看"],
          "已送付": ["编辑", "查看"],
          "已受注": ["编辑", "查看"],
          "已取消": ["编辑", "查看"],
          "拒绝": ["编辑", "查看"]
        },
        accept: {
          "已送付": ["编辑", "查看"],
          "已受注": ["编辑", "查看"],
          "拒绝": ["编辑", "查看"],
          "已取消": ["编辑", "查看"]
        }
      };

      function renderActions(container, labels) {
        container.innerHTML = "";
        labels.forEach((label) => {
          const btn = document.createElement("button");
          const isPrimary = label === "查看";
          btn.className = isPrimary ? "btn-lite" : "btn-ghost";
          btn.type = "button";
          btn.textContent = label;
          btn.dataset.action = label === "编辑" ? "edit" : "view";
          container.appendChild(btn);
        });
      }

      function fillStatusOptions(select, view) {
        if (!select) return;
        const options = (view === "accept"
          ? select.dataset.acceptOptions
          : select.dataset.issueOptions) || "";
        const values = options.split(",").map((v) => v.trim()).filter(Boolean);
        const defaultOption = select.dataset.defaultOption || "";
        select.innerHTML = defaultOption ? `<option>${defaultOption}</option>` : "";
        values.forEach((value) => {
          const opt = document.createElement("option");
          opt.textContent = value;
          select.appendChild(opt);
        });
      }

      function setView(view) {
        switches.forEach((btn) => {
          const active = btn.dataset.view === view;
          btn.classList.toggle("active", active);
          btn.setAttribute("aria-selected", active ? "true" : "false");
        });
        swapNodes.forEach((node) => {
          node.textContent = view === "accept" ? node.dataset.accept : node.dataset.issue;
        });
        swapPlaceholders.forEach((node) => {
          node.setAttribute(
            "placeholder",
            view === "accept" ? node.dataset.acceptPlaceholder : node.dataset.issuePlaceholder
          );
        });
        fillStatusOptions(statusFilter, view);
        rows.forEach((row) => {
          const badge = row.querySelector("[data-status-badge]");
          const status = badge
            ? (view === "accept" ? badge.dataset.acceptStatus : badge.dataset.issueStatus)
            : (view === "accept" ? row.dataset.acceptStatus : row.dataset.issueStatus);
          const actions = row.querySelector("[data-row-actions]");
          if (badge) {
            badge.textContent = status;
            badge.className = "tag " + (statusClass[status] || "neutral");
          }
          if (actions) {
            const labels = (actionsByView[view] || {})[status] || ["详情"];
            renderActions(actions, labels);
          }
        });
      }

      switches.forEach((btn) => {
        btn.addEventListener("click", () => setView(btn.dataset.view));
      });
      setView("issue");

      function currentView() {
        const active = document.querySelector(".switch-btn.active");
        return active ? active.dataset.view : "issue";
      }

      function setDialogMode(mode) {
        const isView = mode === "view";
        if (detailTitle) detailTitle.textContent = isView ? "查看订单" : "编辑订单";
        if (detailSubtitle) {
          detailSubtitle.textContent = isView ? "查看订单详情" : "修改订单信息";
        }
        if (detailSave) detailSave.style.display = isView ? "none" : "";
        Object.values(detailFields).forEach((field) => {
          if (!field) return;
          if (field.tagName === "SELECT") {
            field.disabled = isView;
            return;
          }
          if (field.type === "date") {
            field.disabled = isView;
          } else {
            field.readOnly = isView;
          }
        });
      }

      function openDetailDialog(mode, row) {
        if (!detailDialog || !row) return;
        const view = currentView();
        const status = view === "accept" ? row.dataset.acceptStatus : row.dataset.issueStatus;
        const client = view === "accept" ? row.dataset.clientAccept : row.dataset.clientIssue;

        if (detailFields.orderNo) detailFields.orderNo.value = row.dataset.orderNo || "";
        if (detailFields.project) detailFields.project.value = row.dataset.project || "";
        if (detailFields.client) detailFields.client.value = client || "";
        if (detailFields.engineer) detailFields.engineer.value = row.dataset.engineer || "";
        if (detailFields.price) detailFields.price.value = row.dataset.price || "";
        if (detailFields.hours) detailFields.hours.value = row.dataset.hours || "";
        if (detailFields.start) detailFields.start.value = row.dataset.start || "";
        if (detailFields.end) detailFields.end.value = row.dataset.end || "";
        if (detailFields.createdAt) detailFields.createdAt.value = row.dataset.createdAt || "";
        if (detailFields.creator) detailFields.creator.value = row.dataset.creator || "";
        if (detailFields.owner) detailFields.owner.value = row.dataset.owner || "";
        if (detailFields.updatedAt) detailFields.updatedAt.value = row.dataset.updatedAt || "";
        if (detailFields.updater) detailFields.updater.value = row.dataset.updater || "";

        fillStatusOptions(detailFields.status, view);
        if (detailFields.status && status) detailFields.status.value = status;

        setDialogMode(mode);
        detailDialog.showModal();
      }

      if (createBtn) {
        createBtn.addEventListener("click", () => {
          const view = currentView();
          if (view === "accept") {
            if (createDialogAccept) createDialogAccept.showModal();
          } else {
            if (createDialogIssue) createDialogIssue.showModal();
          }
        });
      }
      document.addEventListener("click", (event) => {
        const btn = event.target.closest("button[data-action]");
        if (!btn) return;
        const row = btn.closest("tr");
        if (!row) return;
        openDetailDialog(btn.dataset.action, row);
      });
      dialogCloseButtons.forEach((button) => {
        button.addEventListener("click", () => {
          const dialog = button.closest("dialog");
          if (dialog) dialog.close();
        });
      });
    })();
  </script>
</body>
</html>
